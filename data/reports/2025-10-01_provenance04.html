
<!doctype html>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Run report</title><link rel="stylesheet" href="../web/styles.css"/>
<div class="wrap">
  <div class="topbar"><a class="btn" href="../index.html">← Leaderboard</a><a class="btn" id="pdf">Export PDF</a></div>
  <h1 id="runid">Run</h1>
  <div id="cards" class="grid"></div>
  <div class="row" style="gap:8px;margin:12px 0">
    <span class="small">View:</span>
    <a class="btn" id="modeBars">Bars</a>
    <a class="btn" id="modeRadar">Radar</a>
  </div>
  <div id="viz"></div>
  <hr class="sep">
  <details class="details"><summary class="pill">▸ Audit trail & proofs</summary><div id="audit"></div></details>
</div>
<script src="../web/common.js"></script>
<script src="../web/radar.js"></script>
<script>
(async ()=>{
  const id = location.pathname.split('/').pop().replace('.html','');
  const board = await loadJSON('../leaderboard.json');
  const run = (board.runs||[]).find(r=>r.id===id) || board.runs?.[0];
  document.getElementById('runid').textContent = id;
  const metrics = Object.entries(run).filter(([k,v])=>['accuracy','grounding','safety','robustness','bias','calibration','trust'].includes(k) && typeof v==='number');
  const cards = document.getElementById('cards');
  cards.innerHTML = metrics.map(([k,v])=>`<div class="card"><div class="metric">${k.charAt(0).toUpperCase()+k.slice(1)}</div><div class="value">${fmt(v)}</div><div class="bar"><span style="width:${(v*100).toFixed(1)}%"></span></div></div>`).join('');
  const viz = document.getElementById('viz'); const canvas = document.createElement('canvas'); viz.appendChild(canvas);
  const labels = metrics.map(m=>m[0]); const values = metrics.map(m=>m[1]);
  drawRadar(canvas, labels, values);
  document.getElementById('modeRadar').onclick=()=>{ viz.innerHTML=''; viz.appendChild(canvas); drawRadar(canvas, labels, values); };
  document.getElementById('modeBars').onclick=()=>{ viz.innerHTML = `<div class='grid'>${metrics.map(([k,v])=>`<div class="card"><div class="metric">${k}</div><div class="value">${fmt(v)}</div><div class="bar"><span style="width:${(v*100).toFixed(1)}%"></span></div></div>`).join('')}</div>`; };
  const details = [];
  if(run.meta){ if(run.meta.topk) details.push(`<div class='card'><div class='metric'>Retrieval candidates</div><div class='small'>${run.meta.topk.map(c=>`• ${c}`).join('<br>')}</div></div>`);
    if(run.meta.citations) details.push(`<div class='card'><div class='metric'>Citations used</div><div class='small'>${run.meta.citations.map(c=>`• ${c}`).join('<br>')}</div></div>`);
    if(run.meta.merkle_root) details.push(`<div class='card'><div class='metric'>Merkle root</div><div class='k'>${run.meta.merkle_root}</div></div>`); }
  document.getElementById('audit').innerHTML = `<div class='grid'>${details.join('')}</div>`;
  document.getElementById('pdf').onclick=()=>window.print();
})();
</script>
