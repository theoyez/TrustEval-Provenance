<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>TrustEval Pro</title>
<link rel="stylesheet" href="config/theme.css">
<style>
body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
header{background:var(--panel);border-bottom:1px solid var(--muted);padding:14px 16px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
.btn{display:inline-block;padding:8px 12px;border:1px solid var(--muted);border-radius:10px;background:#141617;color:var(--ink);text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 16px}
.small{color:var(--ink-dim);font-size:12px}
h1{font-size:28px;margin:14px 0 4px} .lead{color:var(--ink-dim);margin:0 0 12px}
table{width:100%;border-collapse:collapse;margin:12px 0;background:var(--card);border:1px solid var(--muted);border-radius:12px;overflow:hidden}
th,td{padding:12px;border-bottom:1px solid var(--muted);vertical-align:top}
thead th{position:sticky;top:0;background:#141617;z-index:2}
tr:hover{background:#16181a}
.badge{display:inline-flex;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid var(--muted);background:#131416;font-size:12px;white-space:nowrap}
.ok{border-color:var(--ok);color:#d7ffe8} .warn{border-color:var(--warn);color:#fff3bf} .err{border-color:var(--err);color:#ffd7d7}
.chev{cursor:pointer;display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
.drawer{display:none;padding:10px;border:1px solid var(--muted);border-radius:10px;background:#121416;margin:8px 0}
.right{text-align:right}
.input{width:100%;padding:10px;border:1px solid var(--muted);border-radius:10px;margin:10px 0 16px;background:#121416;color:#fff}
.meta-kv{display:grid;grid-template-columns:130px 1fr;gap:6px}
.tip{position:relative;display:inline-flex;align-items:center;gap:6px}
.tip .bubble{visibility:hidden;opacity:0;transition:opacity .15s ease;position:absolute;left:0;top:125%;background:#0f1112;border:1px solid var(--muted);padding:8px 10px;border-radius:8px;min-width:220px;max-width:340px;color:var(--ink-dim);font-size:12px;z-index:5}
.tip:hover .bubble,.tip:focus-within .bubble{visibility:visible;opacity:1}
.arrow{margin-left:6px;color:var(--ink-dim)}
</style>
<script>
const TOOLTIP = {
  "accuracy":"Partial-credit match vs expected (exact / token overlap / edit).",
  "grounding":"Citations must be allowed (Per-Item→Domain). If cited source isn’t in retrieved top-k, score is capped.",
  "safety":"Regex packs for PII/Toxicity/Policy apply bounded deductions.",
  "robustness":"Stability under paraphrase/perturbations; higher is more robust.",
  "bias":"Gap across sensitive cohorts (lower gap → higher score).",
  "calibration":"Does confidence align with correctness? Higher is better.",
  "provenance":"Cryptographic provenance: signed run + Merkle root for cited chunks. ok = verified, warn = partial/missing, error = failed.",
  "trust_score":"Blend includes provenance (see How it works)."
};
</script>
</head><body>
<header>
  <a class="btn" href="https://theoyez.org" target="_blank">theoyez.org</a>
  <nav>
    <a class="btn" href="web/compare.html">Compare</a>
    <a class="btn" href="web/how-it-works.html">How it works</a>
    <a class="btn" href="README.md" target="_blank">README</a>
  </nav>
</header>
<div class="container">
  <h1 id="heroTitle"></h1>
  <p class="lead" id="heroDesc"></p>
  <div class="small">Click a column header to sort. Hover any header for definitions.</div>
  <input id="filter" class="input" placeholder="Filter by run id, model, or meta…">
  <table>
    <thead><tr id="thead"></tr></thead>
    <tbody></tbody>
  </table>
  <p class="small">Updated: <span id="lastUpdated">—</span></p>
</div>

<script>
let runs=[], sortKey=null, sortAsc=true, filterTerm="";
const pct=x=> (x*100).toFixed(1)+'%';

function setSort(map,key){
  document.querySelectorAll('.sortable').forEach(th=>{
    th.setAttribute('aria-sort','none');
    const a = th.querySelector('.arrow'); if(a) a.textContent='↕';
  });
  const th=document.getElementById(map[key]);
  if(!th) return;
  th.setAttribute('aria-sort',sortAsc?'ascending':'descending');
  const a = th.querySelector('.arrow'); if(a) a.textContent=sortAsc?'▲':'▼';
}
function render(){
  const tbody=document.querySelector('tbody');
  const v=runs.filter(r=>{
    if(!filterTerm) return true;
    const hay=(r.run_id+' '+(r.model||'')+' '+Object.values(r.meta||{}).join(' ')).toLowerCase();
    return hay.includes(filterTerm);
  });
  tbody.innerHTML=v.map(R).join('');
  document.querySelectorAll('.chev').forEach(el=>{
    el.addEventListener('click',()=>{
      const id=el.dataset.run; const d=document.getElementById('drawer_'+id);
      const open=d.style.display!=='block'; d.style.display=open?'block':'none';
      el.firstChild.textContent=open?'▾':'▸';
    });
  });
}
function sortBy(key,map){
  if(sortKey===key) sortAsc=!sortAsc; else {sortKey=key; sortAsc=true;}
  runs.sort((a,b)=>{
    const A=a[key], B=b[key];
    if(typeof A==='number' && typeof B==='number') return sortAsc?A-B:B-A;
    return sortAsc?String(A||'').localeCompare(String(B||'')):String(B||'').localeCompare(String(A||''));
  });
  setSort(map,key); render();
}
function metaBlock(m){
  if(!m) return '<div class=small>—</div>';
  const keys=['dataset','prompt_cfg','retriever','date','prov','sig'];
  const rows=keys.filter(k=>m[k]).map(k=>'<div class=small><b>'+k+'</b></div><div class=small>'+m[k]+'</div>').join('');
  return '<div class="meta-kv">'+rows+'</div>';
}

async function load(){
  const site = await fetch('config/site.json').then(r=>r.json());
  const board = await fetch('leaderboard.json').then(r=>r.json());
  runs = (board.runs||[]).slice();
  document.getElementById('lastUpdated').textContent=board.updated_at||'—';
  document.getElementById('heroTitle').textContent = site.hero?.title || '';
  document.getElementById('heroDesc').textContent  = site.hero?.desc || '';

  const map={"run_id":"th-run_id","model":"th-model"};
  const head=document.getElementById('thead');
  const labels=site.labels||{};
  const metricKeys = site.show_columns.filter(k=>!['run_id','model'].includes(k));

  function thWithTip(key,label,sortable=true){
    const help = (TOOLTIP && TOOLTIP[key]) || '';
    const idAttr = 'id="th-'+key+'"';
    const cls = sortable ? 'class="sortable"' : '';
    return '<th '+idAttr+' '+cls+'><div class="tip" tabindex="0">'+label+' <span class="arrow">↕</span><div class="bubble">'+help+'</div></div></th>';
  }
  head.innerHTML= thWithTip('run_id','Run',false) + thWithTip('model','Model') +
    metricKeys.map(k=> thWithTip(k, labels[k]||k)).join('') + thWithTip('provenance','Provenance',false) + '<th>Audit</th><th>Report</th><th>Proofs</th>';
  site.show_columns.forEach(k=>{ if(!map[k]) map[k]='th-'+k; });

  window.R = (r)=>{
    const scoreCells = metricKeys.map(k=>'<td class=right>'+pct(r[k]||0)+'</td>').join('');
    const status=r.audit?.status||'ok'; const badge='badge '+(status==='ok'?'ok':status==='warn'?'warn':'err'); const icon=(status==='ok'?'✓':status==='warn'?'!':'✖');
    const prov=r.provenance||{status:'warn'};
    const provBadge='badge '+(prov.status==='ok'?'ok':prov.status==='warn'?'warn':'err');
    const provIcon=(prov.status==='ok'?'✓':prov.status==='warn'?'!':'✖');
    const proofLink = r.proofs ? '<a href="'+r.proofs.bundle+'">bundle</a>' : '—';
    return '<tr><td>'+r.run_id+'</td>'
      + '<td><div class=chev data-run="'+r.run_id+'">▸ <span class=small>'+ (r.model||'—') +' · meta</span></div></td>'
      + scoreCells
      + '<td><span class="'+provBadge+'">'+provIcon+' '+(prov.status||'warn')+'</span></td>'
      + '<td><span class="'+badge+'">'+icon+' '+status+'</span></td>'
      + '<td><a href="'+r.report+'">Report</a></td>'
      + '<td>'+proofLink+'</td></tr>'
      + '<tr><td colspan="'+(metricKeys.length+5)+'"><div class=drawer id="drawer_'+r.run_id+'">'
        + '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">'
        + '<div><b>Model & run meta</b>'+ metaBlock(r.meta) +'</div>'
        + '<div><b>Retrieval candidates</b><ul class=small>'+ (r.audit?.trail||[]).map(t=>'<li><code>'+t.doc+'</code> · chunk <b>'+t.chunk+'</b> · score '+t.score+'</li>').join('') +'</ul></div>'
        + '<div><b>Proofs</b><div class=small>root: <code>'+ (prov.root||'—') +'</code><br>sig: <code>'+ (r.meta?.sig||'—') +'</code></div></div>'
        + '</div></div></td></tr>';
  };
  render();
  Array.from(head.children).forEach(th=>{
    if(!th.classList.contains('sortable')) return;
    const id=th.id; const key = Object.keys(map).find(k=>map[k]===id) || id.replace('th-','');
    th.addEventListener('click',()=>sortBy(key,map));
    th.tabIndex=0; th.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); sortBy(key,map);} });
  });
  document.getElementById('filter').addEventListener('input', e=>{ filterTerm=(e.target.value||'').toLowerCase(); render(); });
}
window.addEventListener('DOMContentLoaded', load);
</script>
</body></html>
